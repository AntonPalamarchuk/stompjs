!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("StompJs",[],t):"object"==typeof exports?exports.StompJs=t():e.StompJs=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.versions=function(){return[e.V1_0,e.V1_1,e.V1_2]},e.supportedVersions=function(){return e.versions().join(",")},e.protocolVersions=function(){return e.versions().map(function(e){return"v"+e.replace(".","")+".stomp"})},e.V1_0="1.0",e.V1_1="1.1",e.V1_2="1.2",e}();t.Versions=o},function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){var n=e.call(this)||this;return n._heartbeatInfo=new i(n),n.reconnect_delay=0,n.webSocketFactory=t,n.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,e)},n}return o(t,e),t.prototype._parseConnect=function(){for(var e,t,n,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];var i={};if(o.length<2)throw"Connect requires at least 2 arguments";if("function"==typeof o[1])i=o[0],t=o[1],n=o[2],e=o[3];else switch(o.length){case 6:i.login=o[0],i.passcode=o[1],t=o[2],n=o[3],e=o[4],i.host=o[5];break;default:i.login=o[0],i.passcode=o[1],t=o[2],n=o[3],e=o[4]}return[i,t,n,e]},t.prototype.connect=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=this._parseConnect.apply(this,t);o[0]&&(this.connectHeaders=o[0]),o[1]&&(this.onConnect=o[1]),o[2]&&(this.onStompError=o[2]),o[3]&&(this.onWebSocketClose=o[3]),e.prototype.activate.call(this)},t.prototype.disconnect=function(t,n){void 0===n&&(n={}),t&&(this.onDisconnect=t),this.disconnectHeaders=n,e.prototype.deactivate.call(this)},t.prototype.send=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n="");var o=!1===t["content-length"];o&&delete t["content-length"],this.publish({destination:e,headers:t,body:n,skipContentLengthHeader:o})},Object.defineProperty(t.prototype,"reconnect_delay",{set:function(e){this.reconnectDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ws",{get:function(){return this._webSocket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onreceive",{get:function(){return this.onUnhandledMessage},set:function(e){this.onUnhandledMessage=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onreceipt",{get:function(){return this.onUnhandledReceipt},set:function(e){this.onUnhandledReceipt=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heartbeat",{get:function(){return this._heartbeatInfo},set:function(e){this.heartbeatIncoming=e.incoming,this.heartbeatOutgoing=e.outgoing},enumerable:!0,configurable:!0}),t}(n(4).Client);t.CompatClient=r;var i=function(){function e(e){this.client=e}return Object.defineProperty(e.prototype,"outgoing",{get:function(){return this.client.heartbeatOutgoing},set:function(e){this.client.heartbeatOutgoing=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"incoming",{get:function(){return this.client.heartbeatIncoming},set:function(e){this.client.heartbeatIncoming=e},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),r=function(){function e(e){var t=e.command,n=e.headers,o=e.body,r=e.escapeHeaderValues,i=e.skipContentLengthHeader;this.command=t,this.headers=n||{},this.body=o||"",this.escapeHeaderValues=r||!1,this.skipContentLengthHeader=i||!1}return e.prototype.toString=function(){var t=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(var n=0,r=Object.keys(this.headers||{});n<r.length;n++){var i=r[n],s=this.headers[i];this.escapeHeaderValues&&"CONNECT"!==this.command&&"CONNECTED"!==this.command?t.push(i+":"+e.frEscape(""+s)):t.push(i+":"+s)}return this.body&&!this.skipContentLengthHeader&&t.push("content-length:"+e.sizeOfUTF8(this.body)),t.push(o.Byte.LF+this.body),t.join(o.Byte.LF)},e.sizeOfUTF8=function(e){return e?(encodeURI(e).match(/%..|./g)||[]).length:0},e.unmarshallSingle=function(t,n){for(var r=t.search(new RegExp(""+o.Byte.LF+o.Byte.LF)),i=t.substring(0,r).split(o.Byte.LF),s=i.shift(),c={},a=function(e){return e.replace(/^\s+|\s+$/g,"")},u=0,d=i.reverse();u<d.length;u++){var h=d[u],p=h.indexOf(":"),l=a(h.substring(0,p)),f=a(h.substring(p+1));n&&"CONNECT"!==s&&"CONNECTED"!==s&&(f=e.frUnEscape(f)),c[l]=f}var b="",m=r+2;if(c["content-length"]){var g=parseInt(c["content-length"]);b=(""+t).substring(m,m+g)}else for(var _=null,y=m,v=t.length,S=m<=v;(S?y<v:y>v)&&(_=t.charAt(y))!==o.Byte.NULL;S?y++:y--)b+=_;return new e({command:s,headers:c,body:b,escapeHeaderValues:n})},e.unmarshall=function(t,n){null==n&&(n=!1);var r=t.split(new RegExp(""+o.Byte.NULL+o.Byte.LF+"*")),i={frames:[],partial:""};i.frames=r.slice(0,-1).map(function(t){return e.unmarshallSingle(t,n)});var s=r.slice(-1)[0];return s===o.Byte.LF||-1!==s.search(new RegExp(""+o.Byte.NULL+o.Byte.LF+"*$"))?i.frames.push(e.unmarshallSingle(s,n)):i.partial=s,i},e.marshall=function(t){return new e(t).toString()+o.Byte.NULL},e.frEscape=function(e){return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")},e.frUnEscape=function(e){return e.replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\c/g,":").replace(/\\\\/g,"\\")},e}();t.Frame=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Byte={LF:"\n",NULL:"\0"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),r=function(){function e(e){void 0===e&&(e={}),this.reconnectDelay=5e3,this.heartbeatIncoming=1e4,this.heartbeatOutgoing=1e4,this.maxWebSocketFrameSize=16384,this._active=!1;var t=function(){};this.debug=t,this.onConnect=t,this.onDisconnect=t,this.onUnhandledMessage=t,this.onUnhandledReceipt=t,this.onUnhandledFrame=t,this.onStompError=t,this.onWebSocketClose=t,this.connectHeaders={},this.disconnectHeaders={},this.webSocketFactory=function(){return null},this.configure(e)}return Object.defineProperty(e.prototype,"webSocket",{get:function(){return this._webSocket},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return!!this._stompHandler&&this._stompHandler.connected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._stompHandler?this._stompHandler.version:void 0},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){Object.assign(this,e)},e.prototype.activate=function(){this._active=!0,this._connect()},e.prototype._connect=function(){var e=this;this._active?this.connected?this.debug("STOMP: already connected, nothing to do"):(this.debug("Opening Web Socket..."),this._webSocket=this._createWebSocket(),this._stompHandler=new o.StompHandler(this,this._webSocket,{debug:this.debug,connectHeaders:this.connectHeaders,disconnectHeaders:this.disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatOutgoing:this.heartbeatOutgoing,maxWebSocketFrameSize:this.maxWebSocketFrameSize,onConnect:function(t){if(!e._active)return e.debug("STOMP got connected while deactivate was issued, will disconnect now"),void e._disposeStompHandler();e.onConnect(t)},onDisconnect:function(t){e.onDisconnect(t)},onStompError:function(t){e.onStompError(t)},onWebSocketClose:function(t){e.onWebSocketClose(t),e._active&&e._schedule_reconnect()},onUnhandledMessage:function(t){e.onUnhandledMessage(t)},onUnhandledReceipt:function(t){e.onUnhandledReceipt(t)},onUnhandledFrame:function(t){e.onUnhandledFrame(t)}}),this._stompHandler.start()):this.debug("Client has been marked inactive, will not attempt to connect")},e.prototype._createWebSocket=function(){var e=this.webSocketFactory();return e.binaryType="arraybuffer",e},e.prototype._schedule_reconnect=function(){var e=this;this.reconnectDelay>0&&(this.debug("STOMP: scheduling reconnection in "+this.reconnectDelay+"ms"),this._reconnector=setTimeout(function(){e._connect()},this.reconnectDelay))},e.prototype.deactivate=function(){this._active=!1,this._reconnector&&clearTimeout(this._reconnector),this._disposeStompHandler()},e.prototype._disposeStompHandler=function(){this._stompHandler&&(this._stompHandler.dispose(),this._stompHandler=null)},e.prototype.publish=function(e){this._stompHandler.publish(e)},e.prototype.watchForReceipt=function(e,t){this._stompHandler.watchForReceipt(e,t)},e.prototype.subscribe=function(e,t,n){return void 0===n&&(n={}),this._stompHandler.subscribe(e,t,n)},e.prototype.unsubscribe=function(e,t){void 0===t&&(t={}),this._stompHandler.unsubscribe(e,t)},e.prototype.begin=function(e){return this._stompHandler.begin(e)},e.prototype.commit=function(e){this._stompHandler.commit(e)},e.prototype.abort=function(e){this._stompHandler.abort(e)},e.prototype.ack=function(e,t,n){void 0===n&&(n={}),this._stompHandler.ack(e,t,n)},e.prototype.nack=function(e,t,n){void 0===n&&(n={}),this._stompHandler.nack(e,t,n)},e}();t.Client=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(1),i=function(){function e(){}return e.client=function(t,n){null==n&&(n=o.Versions.protocolVersions());return new r.CompatClient(function(){return new(e.WebSocketClass||WebSocket)(t,n)})},e.over=function(e){var t="function"==typeof e?e:function(){return e};return new r.CompatClient(t)},e.WebSocketClass=null,e}();t.Stomp=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),r=n(0),i=n(2),s=function(){function e(e,t,n){void 0===n&&(n={});var o=this;this._client=e,this._webSocket=t,this._serverFrameHandlers={CONNECTED:function(e){o.debug("connected to server "+e.headers.server),o._connected=!0,o._version=e.headers.version,o._version===r.Versions.V1_2&&(o._escapeHeaderValues=!0),o._setupHeartbeat(e.headers),o.onConnect(e)},MESSAGE:function(e){var t,n=e.headers.subscription,i=o._subscriptions[n]||o.onUnhandledMessage,s=e,c=o;t=o._version===r.Versions.V1_2?s.headers.ack:s.headers["message-id"],s.ack=function(e){return void 0===e&&(e={}),c.ack(t,n,e)},s.nack=function(e){return void 0===e&&(e={}),c.nack(t,n,e)},i(s)},RECEIPT:function(e){var t=o._receiptWatchers[e.headers["receipt-id"]];t?(t(e),delete o._receiptWatchers[e.headers["receipt-id"]]):o.onUnhandledReceipt(e)},ERROR:function(e){o.onStompError(e)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.configure(n)}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return this._connected},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){Object.assign(this,e)},e.prototype.start=function(){var e=this;this._webSocket.onmessage=function(t){e.debug("Received data");var n=function(){if("undefined"!=typeof ArrayBuffer&&t.data instanceof ArrayBuffer){var n=new Uint8Array(t.data);e.debug("--- got data length: "+n.length);var o,r=void 0,i=void 0;for(i=[],r=0,o=n.length;r<o;r++){var s=n[r];i.push(String.fromCharCode(s))}return i.join("")}return t.data}();if(e._lastServerActivityTS=Date.now(),n!==o.Byte.LF){e.debug("<<< "+n);var r=i.Frame.unmarshall(e._partialData+n,e._escapeHeaderValues);e._partialData=r.partial;for(var s=0,c=r.frames;s<c.length;s++){var a=c[s];(e._serverFrameHandlers[a.command]||e.onUnhandledFrame)(a)}}else e.debug("<<< PONG")},this._webSocket.onclose=function(t){e.debug("Connection closed to "+e._webSocket.url),e.onWebSocketClose(t),e._cleanUp()},this._webSocket.onopen=function(){e.debug("Web Socket Opened..."),e.connectHeaders["accept-version"]=r.Versions.supportedVersions(),e.connectHeaders["heart-beat"]=[e.heartbeatOutgoing,e.heartbeatIncoming].join(","),e._transmit({command:"CONNECT",headers:e.connectHeaders})}},e.prototype._setupHeartbeat=function(e){var t=this;if(e.version===r.Versions.V1_1||e.version===r.Versions.V1_2){var n=e["heart-beat"].split(",").map(function(e){return parseInt(e)}),i=n[0],s=n[1];if(0!==this.heartbeatOutgoing&&0!==s){var c=Math.max(this.heartbeatOutgoing,s);this.debug("send PING every "+c+"ms"),this._pinger=setInterval(function(){t._webSocket.send(o.Byte.LF),t.debug(">>> PING")},c)}if(0!==this.heartbeatIncoming&&0!==i){var a=Math.max(this.heartbeatIncoming,i);this.debug("check PONG every "+a+"ms"),this._ponger=setInterval(function(){var e=Date.now()-t._lastServerActivityTS;e>2*a&&(t.debug("did not receive server activity for the last "+e+"ms"),t._webSocket.close())},a)}}},e.prototype._transmit=function(e){var t=e.command,n=e.headers,o=e.body,r=e.skipContentLengthHeader,s=i.Frame.marshall({command:t,headers:n,body:o,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:r});for(this.debug(">>> "+s);;){if(!(s.length>this.maxWebSocketFrameSize))return void this._webSocket.send(s);this._webSocket.send(s.substring(0,this.maxWebSocketFrameSize)),s=s.substring(this.maxWebSocketFrameSize),this.debug("remaining = "+s.length)}},e.prototype.dispose=function(){var e=this;if(this.connected)try{this.disconnectHeaders.receipt||(this.disconnectHeaders.receipt="close-"+this._counter++),this.watchForReceipt(this.disconnectHeaders.receipt,function(t){e._webSocket.close(),e._cleanUp(),e.onDisconnect(t)}),this._transmit({command:"DISCONNECT",headers:this.disconnectHeaders})}catch(e){this.debug("Ignoring error during disconnect",e)}else this._webSocket.readyState!==WebSocket.CONNECTING&&this._webSocket.readyState!==WebSocket.OPEN||this._webSocket.close()},e.prototype._cleanUp=function(){this._connected=!1,this._pinger&&clearInterval(this._pinger),this._ponger&&clearInterval(this._ponger)},e.prototype.publish=function(e){var t=e.destination,n=e.headers,o=e.body,r=e.skipContentLengthHeader;n=Object.assign({destination:t},n),this._transmit({command:"SEND",headers:n,body:o,skipContentLengthHeader:r})},e.prototype.watchForReceipt=function(e,t){this._receiptWatchers[e]=t},e.prototype.subscribe=function(e,t,n){void 0===n&&(n={}),n.id||(n.id="sub-"+this._counter++),n.destination=e,this._subscriptions[n.id]=t,this._transmit({command:"SUBSCRIBE",headers:n});var o=this;return{id:n.id,unsubscribe:function(e){return o.unsubscribe(n.id,e)}}},e.prototype.unsubscribe=function(e,t){void 0===t&&(t={}),null==t&&(t={}),delete this._subscriptions[e],t.id=e,this._transmit({command:"UNSUBSCRIBE",headers:t})},e.prototype.begin=function(e){var t=e||"tx-"+this._counter++;this._transmit({command:"BEGIN",headers:{transaction:t}});var n=this;return{id:t,commit:function(){n.commit(t)},abort:function(){n.abort(t)}}},e.prototype.commit=function(e){this._transmit({command:"COMMIT",headers:{transaction:e}})},e.prototype.abort=function(e){this._transmit({command:"ABORT",headers:{transaction:e}})},e.prototype.ack=function(e,t,n){void 0===n&&(n={}),this._version===r.Versions.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit({command:"ACK",headers:n})},e.prototype.nack=function(e,t,n){return void 0===n&&(n={}),this._version===r.Versions.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit({command:"NACK",headers:n})},e}();t.StompHandler=s},function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(4)),o(n(2)),o(n(0)),o(n(1)),o(n(5))},function(e,t,n){e.exports=n(7)}])});
//# sourceMappingURL=stomp.umd.min.js.map