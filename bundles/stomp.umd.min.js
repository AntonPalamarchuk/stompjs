!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("StompJs",[],t):"object"==typeof exports?exports.StompJs=t():e.StompJs=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.versions=function(){return[e.V1_0,e.V1_1,e.V1_2]},e.supportedVersions=function(){return e.versions().join(",")},e.protocolVersions=function(){return e.versions().map(function(e){return"v"+e.replace(".","")+".stomp"})},e.V1_0="1.0",e.V1_1="1.1",e.V1_2="1.2",e}();t.Versions=o},function(e,t,n){"use strict";var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){var n=e.call(this)||this;return n._heartbeatInfo=new i(n),n.reconnect_delay=0,n.webSocketFactory=t,n.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,e)},n}return o(t,e),t.prototype._parseConnect=function(){for(var e,t,n,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];var i={};if(o.length<2)throw"Connect requires at least 2 arguments";if("function"==typeof o[1])i=o[0],t=o[1],n=o[2],e=o[3];else switch(o.length){case 6:i.login=o[0],i.passcode=o[1],t=o[2],n=o[3],e=o[4],i.host=o[5];break;default:i.login=o[0],i.passcode=o[1],t=o[2],n=o[3],e=o[4]}return[i,t,n,e]},t.prototype.connect=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=this._parseConnect.apply(this,t);o[0]&&(this.connectHeaders=o[0]),o[1]&&(this.onConnect=o[1]),o[2]&&(this.onStompError=o[2]),o[3]&&(this.onWebSocketClose=o[3]),e.prototype.activate.call(this)},t.prototype.disconnect=function(t,n){void 0===n&&(n={}),t&&(this.onDisconnect=t),this.disconnectHeaders=n,e.prototype.deactivate.call(this)},t.prototype.send=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n="");var o=!1===t["content-length"];o&&delete t["content-length"],this.publish({destination:e,headers:t,body:n,skipContentLengthHeader:o})},Object.defineProperty(t.prototype,"reconnect_delay",{set:function(e){this.reconnectDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ws",{get:function(){return this._webSocket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onreceive",{get:function(){return this.onUnhandledMessage},set:function(e){this.onUnhandledMessage=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onreceipt",{get:function(){return this.onUnhandledReceipt},set:function(e){this.onUnhandledReceipt=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heartbeat",{get:function(){return this._heartbeatInfo},set:function(e){this.heartbeatIncoming=e.incoming,this.heartbeatOutgoing=e.outgoing},enumerable:!0,configurable:!0}),t}(n(5).Client);t.CompatClient=r;var i=function(){function e(e){this.client=e}return Object.defineProperty(e.prototype,"outgoing",{get:function(){return this.client.heartbeatOutgoing},set:function(e){this.client.heartbeatOutgoing=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"incoming",{get:function(){return this.client.heartbeatIncoming},set:function(e){this.client.heartbeatIncoming=e},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.onFrame=e,this.onIncomingPing=t,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}return e.prototype.parseChunk=function(e){var t=this;(e instanceof ArrayBuffer?new Uint8Array(e):this._encoder.encode(e)).forEach(function(e){t._onByte(e)})},e.prototype._collectFrame=function(e){0!==e&&13!==e&&(10!==e?(this._onByte=this._collectCommand,this._reinjectByte(e)):this.onIncomingPing())},e.prototype._collectCommand=function(e){if(13!==e)return 10===e?(this._results.command=this._consumeTokenAsUTF8(),void(this._onByte=this._collectHeaders)):void this._consumeByte(e)},e.prototype._collectHeaders=function(e){13!==e&&(10!==e?(this._onByte=this._collectHeaderKey,this._reinjectByte(e)):this._setupCollectBody())},e.prototype._reinjectByte=function(e){this._onByte(e)},e.prototype._collectHeaderKey=function(e){if(58===e)return this._headerKey=this._consumeTokenAsUTF8(),void(this._onByte=this._collectHeaderValue);this._consumeByte(e)},e.prototype._collectHeaderValue=function(e){if(13!==e)return 10===e?(this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,void(this._onByte=this._collectHeaders)):void this._consumeByte(e)},e.prototype._setupCollectBody=function(){var e=this._results.headers.filter(function(e){return"content-length"===e[0]})[0];e?(this._bodyBytesRemaining=parseInt(e[1]),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated},e.prototype._collectBodyNullTerminated=function(e){0!==e?this._consumeByte(e):this._retrievedBody()},e.prototype._collectBodyFixedSize=function(e){0!=this._bodyBytesRemaining--?this._consumeByte(e):this._retrievedBody()},e.prototype._retrievedBody=function(){this._results.body=this._consumeTokenAsRaw(),this.onFrame(this._results),this._initState()},e.prototype._consumeByte=function(e){this._token.push(e)},e.prototype._consumeTokenAsUTF8=function(){return this._decoder.decode(this._consumeTokenAsRaw())},e.prototype._consumeTokenAsRaw=function(){var e=new Uint8Array(this._token);return this._token=[],e},e.prototype._initState=function(){this._results={command:void 0,headers:[],body:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame},e}();t.Parser=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),r=function(){function e(e){var t=e.command,n=e.headers,o=e.body,r=e.escapeHeaderValues,i=e.skipContentLengthHeader;this.command=t,this.headers=n||{},this.body=o||"",this.escapeHeaderValues=r||!1,this.skipContentLengthHeader=i||!1}return e.fromRawFrame=function(t,n){for(var o={},r=function(e){return e.replace(/^\s+|\s+$/g,"")},i=0,s=t.headers.reverse();i<s.length;i++){var c=s[i],a=(c.indexOf(":"),r(c[0])),u=r(c[1]);n&&"CONNECT"!==t.command&&"CONNECTED"!==t.command&&(u=e.hdrValueUnEscape(u)),o[a]=u}return new e({command:t.command,headers:o,body:t.body,escapeHeaderValues:n})},e.prototype.toString=function(){return this.serializeCmdAndHeaders()+(this.isBinaryBody()?"<<binary data>>":this.body)},e.prototype.serialize=function(){var t=this.serializeCmdAndHeaders();return this.isBinaryBody()?e.toUnit8Array(t,this.body).buffer:t+this.body+o.Byte.NULL},e.prototype.serializeCmdAndHeaders=function(){var t=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(var n=0,r=Object.keys(this.headers||{});n<r.length;n++){var i=r[n],s=this.headers[i];this.escapeHeaderValues&&"CONNECT"!==this.command&&"CONNECTED"!==this.command?t.push(i+":"+e.hdrValueEscape(""+s)):t.push(i+":"+s)}return this.body&&!this.skipContentLengthHeader&&t.push("content-length:"+this.bodyLength()),t.join(o.Byte.LF)+o.Byte.LF+o.Byte.LF},e.prototype.isBinaryBody=function(){return"string"!=typeof this.body&&this.body.length>0},e.prototype.isBodyEmpty=function(){return 0===this.body.length},e.prototype.bodyLength=function(){return this.isBinaryBody()?this.body.length:e.sizeOfUTF8(this.body)},e.sizeOfUTF8=function(e){return e?(new TextEncoder).encode(e).length:0},e.toUnit8Array=function(e,t){var n=(new TextEncoder).encode(e),o=new Uint8Array([0]),r=new Uint8Array(n.length+t.length+o.length);return r.set(n),r.set(t,n.length),r.set(o,n.length+t.length),r},e.marshall=function(t){return new e(t).serialize()},e.hdrValueEscape=function(e){return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")},e.hdrValueUnEscape=function(e){return e.replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\c/g,":").replace(/\\\\/g,"\\")},e}();t.Frame=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Byte={LF:"\n",NULL:"\0"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),r=function(){function e(e){void 0===e&&(e={}),this.reconnectDelay=5e3,this.heartbeatIncoming=1e4,this.heartbeatOutgoing=1e4,this.maxWebSocketFrameSize=16384,this._active=!1;var t=function(){};this.debug=t,this.onConnect=t,this.onDisconnect=t,this.treatMessageAsBinary=function(e){return!1},this.onUnhandledMessage=t,this.onUnhandledReceipt=t,this.onUnhandledFrame=t,this.onStompError=t,this.onWebSocketClose=t,this.connectHeaders={},this.disconnectHeaders={},this.webSocketFactory=function(){return null},this.configure(e)}return Object.defineProperty(e.prototype,"webSocket",{get:function(){return this._webSocket},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return!!this._stompHandler&&this._stompHandler.connected},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._stompHandler?this._stompHandler.version:void 0},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){Object.assign(this,e)},e.prototype.activate=function(){this._active=!0,this._connect()},e.prototype._connect=function(){var e=this;this._active?this.connected?this.debug("STOMP: already connected, nothing to do"):(this.debug("Opening Web Socket..."),this._webSocket=this._createWebSocket(),this._stompHandler=new o.StompHandler(this,this._webSocket,{debug:this.debug,connectHeaders:this.connectHeaders,disconnectHeaders:this.disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatOutgoing:this.heartbeatOutgoing,maxWebSocketFrameSize:this.maxWebSocketFrameSize,treatMessageAsBinary:this.treatMessageAsBinary,onConnect:function(t){if(!e._active)return e.debug("STOMP got connected while deactivate was issued, will disconnect now"),void e._disposeStompHandler();e.onConnect(t)},onDisconnect:function(t){e.onDisconnect(t)},onStompError:function(t){e.onStompError(t)},onWebSocketClose:function(t){e.onWebSocketClose(t),e._active&&e._schedule_reconnect()},onUnhandledMessage:function(t){e.onUnhandledMessage(t)},onUnhandledReceipt:function(t){e.onUnhandledReceipt(t)},onUnhandledFrame:function(t){e.onUnhandledFrame(t)}}),this._stompHandler.start()):this.debug("Client has been marked inactive, will not attempt to connect")},e.prototype._createWebSocket=function(){var e=this.webSocketFactory();return e.binaryType="arraybuffer",e},e.prototype._schedule_reconnect=function(){var e=this;this.reconnectDelay>0&&(this.debug("STOMP: scheduling reconnection in "+this.reconnectDelay+"ms"),this._reconnector=setTimeout(function(){e._connect()},this.reconnectDelay))},e.prototype.deactivate=function(){this._active=!1,this._reconnector&&clearTimeout(this._reconnector),this._disposeStompHandler()},e.prototype._disposeStompHandler=function(){this._stompHandler&&(this._stompHandler.dispose(),this._stompHandler=null)},e.prototype.publish=function(e){this._stompHandler.publish(e)},e.prototype.watchForReceipt=function(e,t){this._stompHandler.watchForReceipt(e,t)},e.prototype.subscribe=function(e,t,n){return void 0===n&&(n={}),this._stompHandler.subscribe(e,t,n)},e.prototype.unsubscribe=function(e,t){void 0===t&&(t={}),this._stompHandler.unsubscribe(e,t)},e.prototype.begin=function(e){return this._stompHandler.begin(e)},e.prototype.commit=function(e){this._stompHandler.commit(e)},e.prototype.abort=function(e){this._stompHandler.abort(e)},e.prototype.ack=function(e,t,n){void 0===n&&(n={}),this._stompHandler.ack(e,t,n)},e.prototype.nack=function(e,t,n){void 0===n&&(n={}),this._stompHandler.nack(e,t,n)},e}();t.Client=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(1),i=function(){function e(){}return e.client=function(t,n){null==n&&(n=o.Versions.protocolVersions());return new r.CompatClient(function(){return new(e.WebSocketClass||WebSocket)(t,n)})},e.over=function(e){var t="function"==typeof e?e:function(){return e};return new r.CompatClient(t)},e.WebSocketClass=null,e}();t.Stomp=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),r=n(0),i=n(3),s=n(2),c=function(){function e(e,t,n){void 0===n&&(n={});var o=this;this._client=e,this._webSocket=t,this._serverFrameHandlers={CONNECTED:function(e){o.debug("connected to server "+e.headers.server),o._connected=!0,o._version=e.headers.version,o._version===r.Versions.V1_2&&(o._escapeHeaderValues=!0),o._setupHeartbeat(e.headers),o.onConnect(e)},MESSAGE:function(e){var t=e.headers.subscription,n=o._subscriptions[t]||o.onUnhandledMessage,i=e,s=o,c=o._version===r.Versions.V1_2?i.headers.ack:i.headers["message-id"];i.ack=function(e){return void 0===e&&(e={}),s.ack(c,t,e)},i.nack=function(e){return void 0===e&&(e={}),s.nack(c,t,e)},n(i)},RECEIPT:function(e){var t=o._receiptWatchers[e.headers["receipt-id"]];t?(t(e),delete o._receiptWatchers[e.headers["receipt-id"]]):o.onUnhandledReceipt(e)},ERROR:function(e){o.onStompError(e)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.configure(n)}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return this._connected},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){Object.assign(this,e)},e.prototype.start=function(){var e=this,t=new s.Parser(function(t){var n=i.Frame.fromRawFrame(t,e._escapeHeaderValues);if(!e.treatMessageAsBinary(n)||"ERROR"===n.command&&n.headers["content-type"].match(/^text\//))try{n.body=(new TextDecoder).decode(n.body)}catch(e){}e.debug("<<< "+n),(e._serverFrameHandlers[n.command]||e.onUnhandledFrame)(n)},function(){e.debug("<<< PONG")});this._webSocket.onmessage=function(n){e.debug("Received data"),e._lastServerActivityTS=Date.now(),t.parseChunk(n.data)},this._webSocket.onclose=function(t){e.debug("Connection closed to "+e._webSocket.url),e.onWebSocketClose(t),e._cleanUp()},this._webSocket.onopen=function(){e.debug("Web Socket Opened..."),e.connectHeaders["accept-version"]=r.Versions.supportedVersions(),e.connectHeaders["heart-beat"]=[e.heartbeatOutgoing,e.heartbeatIncoming].join(","),e._transmit({command:"CONNECT",headers:e.connectHeaders})}},e.prototype._setupHeartbeat=function(e){var t=this;if(e.version===r.Versions.V1_1||e.version===r.Versions.V1_2){var n=e["heart-beat"].split(",").map(function(e){return parseInt(e)}),i=n[0],s=n[1];if(0!==this.heartbeatOutgoing&&0!==s){var c=Math.max(this.heartbeatOutgoing,s);this.debug("send PING every "+c+"ms"),this._pinger=setInterval(function(){t._webSocket.send(o.Byte.LF),t.debug(">>> PING")},c)}if(0!==this.heartbeatIncoming&&0!==i){var a=Math.max(this.heartbeatIncoming,i);this.debug("check PONG every "+a+"ms"),this._ponger=setInterval(function(){var e=Date.now()-t._lastServerActivityTS;e>2*a&&(t.debug("did not receive server activity for the last "+e+"ms"),t._webSocket.close())},a)}}},e.prototype._transmit=function(e){var t=e.command,n=e.headers,o=e.body,r=e.skipContentLengthHeader,s=new i.Frame({command:t,headers:n,body:o,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:r});this.debug(">>> "+s),this._webSocket.send(s.serialize())},e.prototype.dispose=function(){var e=this;if(this.connected)try{this.disconnectHeaders.receipt||(this.disconnectHeaders.receipt="close-"+this._counter++),this.watchForReceipt(this.disconnectHeaders.receipt,function(t){e._webSocket.close(),e._cleanUp(),e.onDisconnect(t)}),this._transmit({command:"DISCONNECT",headers:this.disconnectHeaders})}catch(e){this.debug("Ignoring error during disconnect "+e)}else this._webSocket.readyState!==WebSocket.CONNECTING&&this._webSocket.readyState!==WebSocket.OPEN||this._webSocket.close()},e.prototype._cleanUp=function(){this._connected=!1,this._pinger&&clearInterval(this._pinger),this._ponger&&clearInterval(this._ponger)},e.prototype.publish=function(e){var t=e.destination,n=e.headers,o=e.body,r=e.skipContentLengthHeader;n=Object.assign({destination:t},n),this._transmit({command:"SEND",headers:n,body:o,skipContentLengthHeader:r})},e.prototype.watchForReceipt=function(e,t){this._receiptWatchers[e]=t},e.prototype.subscribe=function(e,t,n){void 0===n&&(n={}),n.id||(n.id="sub-"+this._counter++),n.destination=e,this._subscriptions[n.id]=t,this._transmit({command:"SUBSCRIBE",headers:n});var o=this;return{id:n.id,unsubscribe:function(e){return o.unsubscribe(n.id,e)}}},e.prototype.unsubscribe=function(e,t){void 0===t&&(t={}),null==t&&(t={}),delete this._subscriptions[e],t.id=e,this._transmit({command:"UNSUBSCRIBE",headers:t})},e.prototype.begin=function(e){var t=e||"tx-"+this._counter++;this._transmit({command:"BEGIN",headers:{transaction:t}});var n=this;return{id:t,commit:function(){n.commit(t)},abort:function(){n.abort(t)}}},e.prototype.commit=function(e){this._transmit({command:"COMMIT",headers:{transaction:e}})},e.prototype.abort=function(e){this._transmit({command:"ABORT",headers:{transaction:e}})},e.prototype.ack=function(e,t,n){void 0===n&&(n={}),this._version===r.Versions.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit({command:"ACK",headers:n})},e.prototype.nack=function(e,t,n){return void 0===n&&(n={}),this._version===r.Versions.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit({command:"NACK",headers:n})},e}();t.StompHandler=c},function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(5)),o(n(3)),o(n(2)),o(n(0)),o(n(1)),o(n(6))},function(e,t,n){e.exports=n(8)}])});
//# sourceMappingURL=stomp.umd.min.js.map